<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Control de Pagos - Clases de V√≥ley</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #2980b9, #6dd5fa);
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      color: #fff;
      box-sizing: border-box;
    }
    h2 {
      margin-top: 30px;
      margin-bottom: 20px;
      font-size: 32px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    .container {
      width: 90%;
      max-width: 900px;
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      color: #333;
      margin-top: 20px;
      margin-bottom: 20px;
    }
    input,
    select,
    button {
      padding: 12px;
      margin: 8px 0;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      width: 100%;
      max-width: 350px;
      box-sizing: border-box;
    }
    button {
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: linear-gradient(135deg, #219150, #27ae60);
      transform: scale(1.05);
    }
    .list-container {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .jugadores-list div {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #ecf0f1;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      display: none;
    }
    th,
    td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #2c3e50;
      color: white;
    }
    tr:nth-child(even) {
      background: #ecf0f1;
    }
    tr:hover {
      background: #d5dbdb;
    }
    .mensaje-error {
      color: red;
      font-weight: bold;
    }
    .mensaje-exito {
      color: green;
      font-weight: bold;
    }
    .mensaje {
      font-size: 14px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h2>üèê Control de Pagos - Clases de V√≥ley üèê</h2>
  <div class="container">
    <!-- Agregar Jugador -->
    <div class="list-container">
      <h3>üë§ Agregar Jugador</h3>
      <select id="categoriaJugador">
        <option value="">Seleccionar categor√≠a</option>
        <option value="Femenino">Femenino</option>
        <option value="Masculino">Masculino</option>
      </select>
      <input type="text" id="nombreJugador" placeholder="Nombre del Jugador" required>
      <button onclick="agregarJugador()">Agregar Jugador</button>
      <div id="mensajeJugador" class="mensaje mensaje-error"></div>
    </div>
    <!-- Filtro de Jugadores por G√©nero (Opcional) -->
    <div class="list-container">
      <h3>üîç Filtrar Jugadores</h3>
      <select id="filtroGenero" onchange="filtrarJugadores()">
        <option value="">Mostrar todos</option>
        <option value="Femenino">Femenino</option>
        <option value="Masculino">Masculino</option>
      </select>
    </div>
    <!-- Lista de Jugadores -->
    <div class="list-container">
      <h3>üìù Lista de Jugadores</h3>
      <div id="jugadoresList" class="jugadores-list"></div>
    </div>
    <!-- Registrar Pago -->
    <div class="list-container">
      <h3>üí∞ Registrar Pago</h3>
      <select id="seleccionarJugador" onchange="mostrarPagosJugador()">
        <option value="">Seleccionar jugador</option>
      </select>
      <input type="number" id="montoTotal" placeholder="Monto total" required>
      <input type="number" id="montoAbonado" placeholder="Monto abonado" required>
      <select id="metodoPago">
        <option value="Efectivo">Efectivo</option>
        <option value="Transferencia">Transferencia</option>
      </select>
      <input type="date" id="fechaPago">
      <button onclick="registrarPago()">Registrar Pago</button>
      <div id="mensajePago" class="mensaje mensaje-error"></div>
    </div>
    <!-- Pagos Registrados -->
    <div class="list-container">
      <h3>üìã Pagos Registrados</h3>
      <table id="tablaPagos">
        <thead>
          <tr>
            <th>Jugador</th>
            <th>Monto Total</th>
            <th>Monto Abonado</th>
            <th>M√©todo de Pago</th>
            <th>Fecha</th>
            <th>Restante</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="detallesPagos"></tbody>
      </table>
    </div>
  </div>
  <script>
    let jugadores = JSON.parse(localStorage.getItem('jugadores') || '[]');
    let pagos = JSON.parse(localStorage.getItem('pagos') || '[]');
    let jugadoresFiltrados = jugadores; // Para el filtro de la lista de jugadores

    // Cargar los jugadores y pagos al inicio
    actualizarListaJugadores();
    actualizarSelectJugadores();

    function agregarJugador() {
      const nombre = document.getElementById("nombreJugador").value.trim();
      const categoria = document.getElementById("categoriaJugador").value;
      if (categoria === "") {
        mostrarMensaje("Por favor, selecciona una categor√≠a para el jugador.", "error", "mensajeJugador");
        return;
      }
      if (nombre === "") {
        mostrarMensaje("Por favor, ingresa un nombre v√°lido.", "error", "mensajeJugador");
        return;
      }
      if (jugadores.some(j => j.nombre === nombre && j.categoria === categoria)) {
        mostrarMensaje("Este jugador ya est√° registrado en esta categor√≠a.", "error", "mensajeJugador");
        return;
      }
      jugadores.push({ nombre, categoria });
      localStorage.setItem('jugadores', JSON.stringify(jugadores));
      actualizarListaJugadores();
      actualizarSelectJugadores();
      document.getElementById("nombreJugador").value = "";
      document.getElementById("categoriaJugador").value = "";
      mostrarMensaje("Jugador agregado correctamente.", "exito", "mensajeJugador");
    }

    function actualizarListaJugadores() {
      const lista = document.getElementById("jugadoresList");
      lista.innerHTML = "";
      // Mostrar seg√∫n filtro (si aplica)
      jugadoresFiltrados.forEach(jugador => {
        const div = document.createElement("div");
        div.textContent = `${jugador.nombre} - ${jugador.categoria}`;
        const botonEliminar = document.createElement("button");
        botonEliminar.textContent = "Eliminar";
        botonEliminar.style.background = "#e74c3c";
        botonEliminar.style.color = "#fff";
        botonEliminar.style.border = "none";
        botonEliminar.style.borderRadius = "6px";
        botonEliminar.style.cursor = "pointer";
        botonEliminar.onclick = () => eliminarJugador(jugador);
        div.appendChild(botonEliminar);
        lista.appendChild(div);
      });
    }

    function actualizarSelectJugadores() {
      const select = document.getElementById("seleccionarJugador");
      select.innerHTML = '<option value="">Seleccionar jugador</option>';
      // Agrupar jugadores por categor√≠a usando optgroup
      const femenino = jugadores.filter(j => j.categoria === "Femenino");
      const masculino = jugadores.filter(j => j.categoria === "Masculino");
      if (femenino.length > 0) {
        const optgroupFem = document.createElement("optgroup");
        optgroupFem.label = "Femenino";
        femenino.forEach(jugador => {
          const option = document.createElement("option");
          option.value = jugador.nombre;
          option.textContent = jugador.nombre;
          optgroupFem.appendChild(option);
        });
        select.appendChild(optgroupFem);
      }
      if (masculino.length > 0) {
        const optgroupMasc = document.createElement("optgroup");
        optgroupMasc.label = "Masculino";
        masculino.forEach(jugador => {
          const option = document.createElement("option");
          option.value = jugador.nombre;
          option.textContent = jugador.nombre;
          optgroupMasc.appendChild(option);
        });
        select.appendChild(optgroupMasc);
      }
    }

    function eliminarJugador(jugador) {
      jugadores = jugadores.filter(j => j !== jugador);
      pagos = pagos.filter(pago => pago.jugador !== jugador.nombre);
      localStorage.setItem('jugadores', JSON.stringify(jugadores));
      localStorage.setItem('pagos', JSON.stringify(pagos));
      actualizarListaJugadores();
      actualizarSelectJugadores();
      mostrarMensaje("Jugador eliminado correctamente.", "exito", "mensajeJugador");
    }

    function filtrarJugadores() {
      const generoSeleccionado = document.getElementById("filtroGenero").value;
      if (generoSeleccionado) {
        jugadoresFiltrados = jugadores.filter(jugador => jugador.categoria === generoSeleccionado);
      } else {
        jugadoresFiltrados = jugadores;
      }
      actualizarListaJugadores();
    }

    function registrarPago() {
      const jugador = document.getElementById("seleccionarJugador").value;
      const montoTotal = document.getElementById("montoTotal").value;
      const montoAbonado = document.getElementById("montoAbonado").value;
      const metodoPago = document.getElementById("metodoPago").value;
      const fechaPago = document.getElementById("fechaPago").value;
      if (!jugador || montoTotal === "" || montoAbonado === "" || fechaPago === "") {
        mostrarMensaje("Por favor, completa todos los campos.", "error", "mensajePago");
        return;
      }
      if (parseFloat(montoAbonado) > parseFloat(montoTotal)) {
        mostrarMensaje("El monto abonado no puede ser mayor que el monto total.", "error", "mensajePago");
        return;
      }
      pagos.push({
        jugador,
        montoTotal: parseFloat(montoTotal),
        montoAbonado: parseFloat(montoAbonado),
        metodoPago,
        fechaPago: new Date(fechaPago).toLocaleDateString('es-ES')
      });
      localStorage.setItem('pagos', JSON.stringify(pagos));
      document.getElementById("montoTotal").value = "";
      document.getElementById("montoAbonado").value = "";
      document.getElementById("fechaPago").value = "";
      mostrarMensaje("Pago registrado correctamente.", "exito", "mensajePago");
      mostrarPagosJugador();
    }

    function eliminarPago(index) {
      pagos.splice(index, 1);
      localStorage.setItem('pagos', JSON.stringify(pagos));
      mostrarPagosJugador();
      mostrarMensaje("Pago eliminado correctamente.", "exito", "mensajePago");
    }

    function mostrarPagosJugador() {
      const jugadorSeleccionado = document.getElementById("seleccionarJugador").value;
      const tablaPagos = document.getElementById("tablaPagos");
      if (!jugadorSeleccionado) {
        tablaPagos.style.display = "none";
        return;
      }
      const pagosJugador = pagos.filter(pago => pago.jugador === jugadorSeleccionado);
      const detallesPagos = document.getElementById("detallesPagos");
      detallesPagos.innerHTML = "";
      pagosJugador.forEach((pago, index) => {
        const fila = document.createElement("tr");
        const montoRestante = pago.montoTotal - pago.montoAbonado;
        const filaRestante = montoRestante > 0 ? `<td style="color: red;">$${montoRestante.toFixed(2)}</td>` : `<td style="color: green;">Pago Completo</td>`;
        fila.innerHTML = `
          <td>${pago.jugador}</td>
          <td>$${pago.montoTotal.toFixed(2)}</td>
          <td>$${pago.montoAbonado.toFixed(2)}</td>
          <td>${pago.metodoPago}</td>
          <td>${pago.fechaPago}</td>
          ${filaRestante}
          <td><button onclick="eliminarPago(${index})" style="background:#e74c3c;color:white;padding:8px 12px;border:none;border-radius:6px;">Eliminar</button></td>
        `;
        detallesPagos.appendChild(fila);
      });
      tablaPagos.style.display = pagosJugador.length > 0 ? "table" : "none";
    }

    function mostrarMensaje(mensaje, tipo, elementoId) {
      const mensajeDiv = document.getElementById(elementoId);
      mensajeDiv.textContent = mensaje;
      mensajeDiv.className = `mensaje mensaje-${tipo}`;
    }
  </script>
</body>
</html>
